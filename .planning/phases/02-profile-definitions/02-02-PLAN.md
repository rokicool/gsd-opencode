---
phase: 02-profile-definitions
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - gsd-opencode/get-shit-done/lib/config.md
  - .planning/phases/02-profile-definitions/02-UAT.md
  - .planning/phases/02-profile-definitions/02-02-SUMMARY.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "A reader can verify that Phase 2 only added/updated profiles.* in .planning/config.json and did not remove unrelated keys."
    - "Documentation explicitly explains why different repos may have more/other top-level config keys, and that writeConfig() must preserve unknown keys."
    - "Phase 2 UAT gap is updated with a concrete root cause and a reproducible verification method."
    - "A Phase 2 Plan 02 summary exists and records what changed + how the UAT gap was closed."
  artifacts:
    - path: "gsd-opencode/get-shit-done/lib/config.md"
      provides: "Documentation clarifying minimal baseline config keys and key-preservation behavior"
      contains: "Key preservation note"
    - path: ".planning/phases/02-profile-definitions/02-UAT.md"
      provides: "Closed gap record for config key preservation concern"
      contains: "root_cause"
    - path: ".planning/phases/02-profile-definitions/02-02-SUMMARY.md"
      provides: "Execution summary for 02-02 gap-closure plan"
      contains: "02-profile-definitions"
  key_links:
    - from: "gsd-opencode/get-shit-done/lib/config.md"
      to: ".planning/config.json"
      via: "Documented writeConfig() deep-merge preservation behavior"
      pattern: "preserve|unknown keys|deepMerge|overlay"
---

<objective>
Close Phase 2 UAT gap by documenting and proving that the profile preset work did not remove any unrelated `.planning/config.json` keys, and that different repos may legitimately have different baseline keys.

Purpose: Resolve user uncertainty about whether config keys were removed, and make the expected “key preservation” behavior explicit and reproducible.
Output: Updated docs + updated UAT with root cause + verification steps.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/02-profile-definitions/02-UAT.md
@.planning/phases/02-profile-definitions/02-01-SUMMARY.md
@gsd-opencode/get-shit-done/lib/config.md

# Evidence source (git history)
# - `.planning/config.json` initial baseline in this repo: `git show ec90fca:.planning/config.json`
# - Phase 1 schema extension: `git show c564cb4:.planning/config.json`
# - Phase 2 preset seeding: `git show 418cff8:.planning/config.json`
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document baseline config variability and key-preservation guarantee</name>
  <files>
    gsd-opencode/get-shit-done/lib/config.md
  </files>
  <action>
    Update `gsd-opencode/get-shit-done/lib/config.md` to explicitly address the UAT concern:

    1) Add a short section near the schema description (either under “Config Schema” or under “Defaults (built-in)”) titled something like:
       - "Key preservation note" or
       - "Why different repos may have more config keys"

    2) In that section, state clearly:
       - This repository’s `.planning/config.json` started as a minimal baseline (`mode`, `depth`, `parallelization`).
       - Other repos created from different templates or later phases may include additional top-level keys (examples: `gates`, richer `parallelization`, etc.).
       - The intended behavior of `writeConfig()` is to deep-merge overlays and preserve all existing unknown keys (i.e., profile work must never delete unrelated keys).

    3) Add a concrete, reproducible verification snippet using git (keep it short, 3-6 lines):
       - `git log --oneline -- .planning/config.json`
       - `git show ec90fca:.planning/config.json`
       - `git show 418cff8:.planning/config.json`
       Explain that diffs should show only additive changes for `profiles.*`.

    Constraints:
    - Do NOT change `.planning/config.json` in this plan.
    - Keep it documentation-only; no code changes needed.
  </action>
  <verify>
    - `rg -n "Key preservation note|different repos" gsd-opencode/get-shit-done/lib/config.md`
    - Confirm the new section includes at least one of the commands: `git log --oneline -- .planning/config.json` or `git show ec90fca:.planning/config.json`.
  </verify>
  <done>
    `config.md` explicitly explains baseline variability across repos and re-states the guarantee that config writes preserve unknown keys (deep-merge overlay), with a concrete git-based verification recipe.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Phase 2 UAT to close the gap with root cause and verification evidence</name>
  <files>
    .planning/phases/02-profile-definitions/02-UAT.md
  </files>
  <action>
    Update `.planning/phases/02-profile-definitions/02-UAT.md` to resolve the single recorded gap.

    1) In “### 1. Presets Exist In config.json”, change the result from `issue` to `pass` AND add a short note explaining:
       - The repo’s baseline config started minimal (reference the initial config commit snapshot).
       - Phase 1/2 work extended config by *adding* `profiles.*` but did not remove any other keys.

     1b) Update the `## Summary` section counts to reflect the new status (e.g., Passed count increments after Test 1 is `pass`, and any “issues”/“failed” counts drop accordingly).

    2) In the “## Gaps” entry, populate the previously-empty fields:
       - `root_cause`: explain the mismatch came from comparing to a different repository/template that had more baseline keys, not from key deletion here.
       - `artifacts`: list relevant artifacts explicitly (at minimum `.planning/config.json`; optionally include `gsd-opencode/get-shit-done/lib/config.md` as supporting docs).
       - `missing`: add the exact verification commands used to prove non-destructive changes (use git commands; keep it to a small bullet list).

    3) Update the gap `status` to an explicit closed state used in this repo’s conventions (choose one):
       - `status: closed` OR
       - `status: fixed`
       (Prefer `closed`.)

    Constraints:
    - Do not edit any other phases’ UAT/verification files.
    - Do not change code; this is a documentation + UAT record correction.
  </action>
  <verify>
    - Confirm the UAT summary counts reflect 5/5 passed (or no remaining issues).
    - Run: `git log --oneline -- .planning/config.json` and confirm commits show additive profile changes (no unexpected deletion commit).
  </verify>
  <done>
    The Phase 2 UAT file contains a clear root cause and reproducible verification steps, and no longer reports an open gap for “config key preservation.”
  </done>
</task>

<task type="auto">
  <name>Task 3: Create 02-02 execution summary</name>
  <files>
    .planning/phases/02-profile-definitions/02-02-SUMMARY.md
  </files>
  <action>
    Create `.planning/phases/02-profile-definitions/02-02-SUMMARY.md` using the standard summary template.

    Content requirements (keep it concise):
    - State that this plan closed the Phase 2 UAT gap about config key preservation.
    - List the artifacts updated in this plan:
      - `gsd-opencode/get-shit-done/lib/config.md`
      - `.planning/phases/02-profile-definitions/02-UAT.md`
    - Include the exact git verification commands you used (the same ones recorded in the UAT gap) so a reader can reproduce.
    - Note the final UAT status (gap status closed/fixed and the summary shows no remaining issues).
  </action>
  <verify>
    - `test -f .planning/phases/02-profile-definitions/02-02-SUMMARY.md`
    - `rg -n "UAT gap|key preservation|git (log|show)" .planning/phases/02-profile-definitions/02-02-SUMMARY.md`
  </verify>
  <done>
    `02-02-SUMMARY.md` exists and clearly records what changed and how the Phase 2 UAT gap was closed, including reproducible git commands.
  </done>
</task>

</tasks>

<verification>
- Open `.planning/phases/02-profile-definitions/02-UAT.md` and confirm the “Summary” section reports no issues.
- Confirm `gsd-opencode/get-shit-done/lib/config.md` contains the new explanatory section and references key preservation behavior.
</verification>

<success_criteria>
- Phase 2 UAT has zero open gaps.
- A new reader can reproduce the “no keys removed” verification with git commands without needing tribal knowledge.
</success_criteria>

<output>
After completion, create `.planning/phases/02-profile-definitions/02-02-SUMMARY.md`.
</output>
