---
phase: 02-profile-definitions
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - gsd-opencode/get-shit-done/lib/config.md
  - .planning/config.json
autonomous: true

must_haves:
  truths:
    - "Three presets available: quality, balanced, budget"
    - "Each preset maps specific models to planning/execution/verification stages"
    - "User can edit preset definitions by modifying config.json"
    - "getPresetConfig() returns stage-to-model mappings for any valid preset"
  artifacts:
    - path: "gsd-opencode/get-shit-done/lib/config.md"
      provides: "Preset definitions and getPresetConfig() procedure"
      contains: "getPresetConfig"
    - path: ".planning/config.json"
      provides: "Editable preset definitions"
      contains: "presets"
  key_links:
    - from: "getPresetConfig()"
      to: "config.json presets section"
      via: "readConfig() then lookup"
      pattern: "profiles\\.presets"
---

<objective>
Define three semantic presets (quality, balanced, budget) with stage-to-model mappings in the config system.

Purpose: Enable profile-based model selection for planning/execution/verification stages
Output: Extended config.md library with preset definitions and getPresetConfig() procedure; config.json seeded with editable preset mappings
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-profile-definitions/02-CONTEXT.md
@gsd-opencode/get-shit-done/lib/config.md
@.planning/config.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend config.md with preset definitions and getPresetConfig()</name>
  <files>gsd-opencode/get-shit-done/lib/config.md</files>
  <action>
Add a new section "## Preset Definitions" to config.md after the existing "## Procedures" section.

**Add preset schema documentation:**

Show the schema for preset definitions under `profiles.presets`:
```jsonc
{
  "profiles": {
    "active_profile": "balanced",
    "presets": {
      "quality": {
        "planning": "opencode/glm-4.7-free",
        "execution": "opencode/glm-4.7-free",
        "verification": "opencode/glm-4.7-free"
      },
      "balanced": {
        "planning": "opencode/glm-4.7-free",
        "execution": "opencode/minimax-m2.1-free",
        "verification": "opencode/glm-4.7-free"
      },
      "budget": {
        "planning": "opencode/minimax-m2.1-free",
        "execution": "opencode/grok-code",
        "verification": "opencode/minimax-m2.1-free"
      }
    },
    "custom_overrides": {}
  }
}
```

**Add agent-to-stage mapping documentation:**

| Stage | Agents |
|-------|--------|
| planning | gsd-planner, gsd-plan-checker, gsd-phase-researcher, gsd-roadmapper, gsd-project-researcher, gsd-research-synthesizer, gsd-codebase-mapper |
| execution | gsd-executor, gsd-debugger |
| verification | gsd-verifier, gsd-integration-checker |

**Add getPresetConfig(presetName) procedure:**

Purpose: Get the stage-to-model mappings for a preset.

Behavior:
1. Validate presetName via validateProfile()
2. Read config via readConfig()
3. Return the preset's stage mappings from config.profiles.presets[presetName]
4. If preset not found in config (should not happen with proper seeding), use built-in defaults

Returns: Object with { planning: string, execution: string, verification: string }

Pseudocode:
```ts
function getPresetConfig(presetName) {
  const validation = validateProfile(presetName);
  if (!validation.valid) {
    return { ok: false, error: validation.error };
  }

  const BUILTIN_DEFAULTS = {
    quality: {
      planning: "opencode/glm-4.7-free",
      execution: "opencode/glm-4.7-free",
      verification: "opencode/glm-4.7-free"
    },
    balanced: {
      planning: "opencode/glm-4.7-free",
      execution: "opencode/minimax-m2.1-free",
      verification: "opencode/glm-4.7-free"
    },
    budget: {
      planning: "opencode/minimax-m2.1-free",
      execution: "opencode/grok-code",
      verification: "opencode/minimax-m2.1-free"
    }
  };

  const config = readConfig();
  const presets = config?.profiles?.presets ?? BUILTIN_DEFAULTS;
  const preset = presets[presetName] ?? BUILTIN_DEFAULTS[presetName];

  return {
    ok: true,
    preset: {
      planning: preset.planning,
      execution: preset.execution,
      verification: preset.verification
    }
  };
}
```

**Add getAgentsForStage(stage) procedure:**

Purpose: Return the list of agents that belong to a given stage.

Pseudocode:
```ts
function getAgentsForStage(stage) {
  const STAGE_AGENTS = {
    planning: [
      "gsd-planner",
      "gsd-plan-checker", 
      "gsd-phase-researcher",
      "gsd-roadmapper",
      "gsd-project-researcher",
      "gsd-research-synthesizer",
      "gsd-codebase-mapper"
    ],
    execution: [
      "gsd-executor",
      "gsd-debugger"
    ],
    verification: [
      "gsd-verifier",
      "gsd-integration-checker"
    ]
  };

  return STAGE_AGENTS[stage] ?? [];
}
```

**Update the DEFAULTS constant in readConfig() pseudocode:**

Add presets to the default structure so auto-heal can restore them if missing.
  </action>
  <verify>
Read config.md and confirm:
- Preset Definitions section exists with schema documentation
- Agent-to-stage mapping table is present
- getPresetConfig() procedure is documented with pseudocode
- getAgentsForStage() procedure is documented
- DEFAULTS in readConfig() includes presets structure
  </verify>
  <done>
config.md documents all three presets with their stage-to-model mappings, the agent-to-stage mapping, and procedures to retrieve preset configuration
  </done>
</task>

<task type="auto">
  <name>Task 2: Seed config.json with editable preset definitions</name>
  <files>.planning/config.json</files>
  <action>
Update .planning/config.json to include the preset definitions under profiles.presets.

The updated config.json should be:
```json
{
  "mode": "yolo",
  "depth": "comprehensive",
  "parallelization": true,
  "profiles": {
    "active_profile": "balanced",
    "presets": {
      "quality": {
        "planning": "opencode/glm-4.7-free",
        "execution": "opencode/glm-4.7-free",
        "verification": "opencode/glm-4.7-free"
      },
      "balanced": {
        "planning": "opencode/glm-4.7-free",
        "execution": "opencode/minimax-m2.1-free",
        "verification": "opencode/glm-4.7-free"
      },
      "budget": {
        "planning": "opencode/minimax-m2.1-free",
        "execution": "opencode/grok-code",
        "verification": "opencode/minimax-m2.1-free"
      }
    },
    "custom_overrides": {}
  }
}
```

Use 2-space indentation and trailing newline per config.md conventions.

Preserve ALL existing keys (mode, depth, parallelization, active_profile, custom_overrides).
  </action>
  <verify>
Run: `cat .planning/config.json | jq .`

Confirm:
- profiles.presets.quality exists with planning/execution/verification keys
- profiles.presets.balanced exists with planning/execution/verification keys
- profiles.presets.budget exists with planning/execution/verification keys
- Original keys (mode, depth, parallelization) are preserved
- File is valid JSON
  </verify>
  <done>
config.json contains all three preset definitions with stage-to-model mappings that users can edit directly
  </done>
</task>

</tasks>

<verification>
1. config.md has preset definitions section with getPresetConfig() and getAgentsForStage() procedures
2. config.json has profiles.presets with quality, balanced, budget mappings
3. Each preset has planning, execution, verification model assignments
4. Model names match PROJECT.md specifications exactly
5. User can edit config.json to change preset model assignments
</verification>

<success_criteria>
- Three presets defined: quality, balanced, budget
- Each preset maps to specific models for planning/execution/verification stages per PROJECT.md
- Presets are stored in config.json where users can edit them
- getPresetConfig() procedure documented for retrieving stage mappings
- getAgentsForStage() procedure documented for future frontmatter rewriting (Phase 5)
</success_criteria>

<output>
After completion, create `.planning/phases/02-profile-definitions/02-01-SUMMARY.md`
</output>
