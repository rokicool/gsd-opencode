---
phase: 03-set-profile-command
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [gsd-opencode/agents/gsd-set-profile.md]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can switch profile using positional argument: `/gsd-set-profile quality`"
    - "Positional argument takes precedence when both positional and flags are provided"
    - "Invalid positional profile name triggers fuzzy suggestion flow"
  artifacts:
    - path: "gsd-opencode/agents/gsd-set-profile.md"
      provides: "Positional argument parsing in Invocation section"
      contains: "/gsd-set-profile quality"
  key_links:
    - from: "gsd-set-profile.md invocation parsing"
      to: "validateProfile() in config.md"
      via: "Invalid positional name triggers validation"
      pattern: "validateProfile.*positional"
---

<objective>
Add positional argument support to the `/gsd-set-profile` command agent.

Purpose: Close the verification gap where CMD-01 requires `/gsd-set-profile <profile>` positional invocation but only flag-based and interactive selection were documented.

Output: Updated `gsd-set-profile.md` with positional argument parsing rules and examples.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-set-profile-command/03-VERIFICATION.md
@.planning/phases/03-set-profile-command/03-01-SUMMARY.md

# Target file to update
@gsd-opencode/agents/gsd-set-profile.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add positional argument support to gsd-set-profile agent</name>
  <files>gsd-opencode/agents/gsd-set-profile.md</files>
  <action>
Update the Invocation section to add a third invocation style for positional arguments:

1. In the `## Invocation` section, add a third style after the existing two:

```
3) **Positional argument (direct selection)**

/gsd-set-profile quality
/gsd-set-profile balanced
/gsd-set-profile budget
```

2. Add a new subsection `### Argument parsing precedence` after `### Flag parsing rules`:

Document the precedence order:
- First positional argument wins (if provided and valid)
- If no positional, flags are checked (last flag wins per existing rules)
- If neither, fall back to interactive picker

Example rule text:
```
### Argument parsing precedence

When multiple selection methods are provided:

1. **Positional argument** (first non-flag token) — highest priority
2. **Flags** (`--quality`, `-q`, etc.) — checked if no positional
3. **Interactive picker** — used if neither positional nor flags

Examples:
- `/gsd-set-profile quality --budget` → uses `quality` (positional wins)
- `/gsd-set-profile --budget` → uses `budget` (flag, no positional)
- `/gsd-set-profile` → interactive picker
```

3. In Step 1 of `<behavior>`, add a new case between the interactive picker (A) and flag-based (B):

```
### B) Positional argument selection

If invoked with a positional argument (first non-flag token):

1. Extract the first positional token
2. Check if it matches a valid profile name (quality/balanced/budget)
3. If valid, set `newProfile` to that value
4. If invalid, use `validateProfile(token)` for fuzzy suggestion (same as unknown flag handling in section C)
```

Renumber existing sections: current B becomes C, current C becomes D.

4. Update the "Unknown flag handling" section (now D) to also cover invalid positional arguments:

Change the heading to: `### D) Invalid profile handling (positional or flag)`

Update the text to clarify this applies to both:
- Unknown flags (e.g., `--fast`)
- Invalid positional arguments (e.g., `/gsd-set-profile turbo`)

Both trigger the same `validateProfile()` suggestion flow.
  </action>
  <verify>
Read the updated file and confirm:
- "Positional argument" appears in Invocation section
- `/gsd-set-profile quality` example is documented
- Precedence rules are documented (positional > flags > picker)
- Invalid positional handling routes to validateProfile()
  </verify>
  <done>
The agent specification documents positional argument invocation (`/gsd-set-profile quality|balanced|budget`) with clear precedence rules and validation flow, satisfying CMD-01 and closing the verification gap.
  </done>
</task>

</tasks>

<verification>
After task completion:

1. Read `gsd-opencode/agents/gsd-set-profile.md`
2. Verify the Invocation section includes positional argument style
3. Verify precedence rules are documented
4. Verify invalid positional names route to validateProfile() suggestion flow
5. Grep for "positional" to confirm documentation exists
</verification>

<success_criteria>
- [ ] Invocation section documents three styles: interactive, flags, AND positional
- [ ] `/gsd-set-profile quality|balanced|budget` examples appear
- [ ] Precedence order documented: positional > flags > picker
- [ ] Invalid positional names trigger validateProfile() fuzzy suggestion
- [ ] All changes committed
</success_criteria>

<output>
After completion, create `.planning/phases/03-set-profile-command/03-02-SUMMARY.md`
</output>
