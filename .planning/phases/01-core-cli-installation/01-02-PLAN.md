---
phase: 01-core-cli-installation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/utils/interactive.js
autonomous: true

must_haves:
  truths:
    - "Interactive prompts support selection and confirmation"
    - "Default option is pre-selected in multi-choice prompts"
    - "Ctrl+C cleanly aborts with no side effects"
  artifacts:
    - path: "src/utils/interactive.js"
      provides: "Interactive user prompts"
      exports: ["promptInstallScope", "promptConfirmation", "promptRepairOrFresh"]
    - path: "package.json"
      provides: "Updated dependencies"
      contains: "@inquirer/prompts"
  key_links:
    - from: "src/utils/interactive.js"
      to: "@inquirer/prompts"
      via: "select and confirm imports"
      pattern: "import { select, confirm } from '@inquirer/prompts'"
---

<objective>
Create interactive prompt utilities for user input when CLI flags are not provided. Handles install scope selection, confirmations, and repair decisions.

Purpose: Enable interactive CLI experience with proper signal handling so Ctrl+C aborts cleanly.
Output: Interactive utility module with promptInstallScope, promptConfirmation, and promptRepairOrFresh functions.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/01-core-cli-installation/01-CONTEXT.md
@.planning/research/SUMMARY.md

## Implementation Notes

From RESEARCH.md:
- Use **@inquirer/prompts (^13.2.2)** - rewritten for reduced package size (10m dependents)
- Interactive prompts show options with default pre-selected (Global highlighted as default)
- Ctrl+C during install cleanly aborts with no side effects â€” no files created or modified

From CONTEXT.md:
- Interactive prompts show options with default pre-selected (Global highlighted as default)
- If partial/broken installation detected, prompt user: "Repair existing or fresh install?"

Dependencies: None (Wave 1 - can run in parallel with Plan 01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @inquirer/prompts dependency</name>
  <files>package.json</files>
  <action>
Install @inquirer/prompts package:

1. Run: `npm install @inquirer/prompts@^13.2.2`

2. Verify installation:
   - Check node_modules/@inquirer/prompts exists
   - Check package.json shows the dependency

3. Note: @inquirer/prompts is ESM-only and supports the select, confirm, and input prompt types we need.
  </action>
  <verify>
Run: `node -e "import('@inquirer/prompts').then(m => console.log(Object.keys(m)))"`
Expected: Should show exported functions including 'select', 'confirm', 'input'
  </verify>
  <done>@inquirer/prompts installed and importable</done>
</task>

<task type="auto">
  <name>Task 2: Create interactive prompt utility module</name>
  <files>src/utils/interactive.js</files>
  <action>
Create src/utils/interactive.js with interactive prompt functions:

1. Import required functions from @inquirer/prompts:
   - `select` - For choosing from options
   - `confirm` - For yes/no confirmations

2. Create `promptInstallScope()` function:
   - Prompt: "Where would you like to install GSD-OpenCode?"
   - Options:
     * "Global (~/.config/opencode/)" - value: 'global', marked as default
     * "Local (./.opencode/)" - value: 'local'
   - Return: 'global' or 'local'
   - Handle Ctrl+C (SIGINT) gracefully - return null or throw cancellation error
   - Use theme to style consistently with CLI branding

3. Create `promptConfirmation(message, defaultValue = true)` function:
   - Parameters: message (string), defaultValue (boolean)
   - Return: boolean
   - Example use: "Remove existing installation?" -> true/false
   - Handle Ctrl+C gracefully

4. Create `promptRepairOrFresh()` function:
   - Prompt: "Existing installation detected. What would you like to do?"
   - Options:
     * "Repair existing installation" - value: 'repair'
     * "Fresh install (remove existing)" - value: 'fresh'
     * "Cancel" - value: 'cancel'
   - Return: 'repair', 'fresh', or 'cancel'
   - Handle Ctrl+C as 'cancel'

5. Implement signal handling:
   - Wrap all prompts in try/catch
   - If prompt throws (user pressed Ctrl+C), return null or a cancellation sentinel
   - Ensure no partial state is left when cancelled

6. Add JSDoc comments for all functions

Example usage:
```javascript
import { promptInstallScope, promptConfirmation } from './utils/interactive.js';

const scope = await promptInstallScope();
if (scope === null) {
  console.log('Installation cancelled');
  process.exit(0);
}

const confirmed = await promptConfirmation('Proceed with installation?', true);
```

Avoid:
- Mixing sync and async code (all prompts are async)
- Ignoring Ctrl+C (must handle gracefully)
- Hardcoding default paths in prompts (use constants)
- Complex validation in prompts (validate after receiving input)
  </action>
  <verify>
Test script:
```javascript
import { promptInstallScope } from './src/utils/interactive.js';
// Can't fully test interactively, but verify module loads:
console.log('promptInstallScope:', typeof promptInstallScope);
```
Run: `node -e "import('./src/utils/interactive.js').then(m => console.log(Object.keys(m)))"`
Expected: Should show exported functions
  </verify>
  <done>Interactive module exports all prompt functions and handles module loading</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. Verify package.json includes @inquirer/prompts in dependencies
2. Run `node -e "import('./src/utils/interactive.js')"` - should not throw
3. Verify module exports: promptInstallScope, promptConfirmation, promptRepairOrFresh
</verification>

<success_criteria>
- @inquirer/prompts is installed and working
- promptInstallScope() returns 'global' or 'local' based on user selection
- promptConfirmation() returns boolean
- promptRepairOrFresh() returns 'repair', 'fresh', or 'cancel'
- All functions handle Ctrl+C gracefully (no uncaught exceptions)
- Module can be imported without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-cli-installation/01-02-SUMMARY.md`
</output>
