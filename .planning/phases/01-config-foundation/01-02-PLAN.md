---
phase: 01-config-foundation
plan: 02
type: execute
wave: 1
depends_on: ["01-01"]
files_modified:
  - .planning/config.json
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Config changes persist to .planning/config.json and survive session restarts"
    - "Existing config keys (mode, depth, parallelization) are preserved when extending"
  artifacts:
    - path: ".planning/config.json"
      provides: "Profiles schema with active_profile and custom_overrides"
      contains: "profiles"
  key_links:
    - from: "gsd-opencode/get-shit-done/lib/config.md"
      to: ".planning/config.json"
      via: "schema structure matches documented format"
      pattern: "profiles.*active_profile"
---

<objective>
Seed `.planning/config.json` with the profiles schema to close Phase 1 verification gaps.

Purpose: The config helper library (01-01) documented the profiles schema, but `.planning/config.json` was never extended. This plan adds the profiles structure while preserving existing keys (mode, depth, parallelization), demonstrating the merge/preservation behavior works.

Output: `.planning/config.json` extended with `profiles.active_profile` and `profiles.custom_overrides`
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Reference the config library for schema structure
@gsd-opencode/get-shit-done/lib/config.md

# Gap source
@.planning/phases/01-config-foundation/01-config-foundation-VERIFICATION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend config.json with profiles schema</name>
  <files>.planning/config.json</files>
  <action>
Read the current `.planning/config.json` (contains mode, depth, parallelization).

Add the profiles schema as documented in config.md:

```json
{
  "mode": "yolo",
  "depth": "comprehensive",
  "parallelization": true,
  "profiles": {
    "active_profile": "balanced",
    "custom_overrides": {}
  }
}
```

Requirements:
- Preserve ALL existing keys exactly (mode, depth, parallelization)
- Add `profiles` object with `active_profile` set to "balanced" (the documented default)
- Add empty `custom_overrides` object (ready for Phase 2)
- Maintain 2-space indentation
- Include trailing newline

This demonstrates the merge/overlay behavior documented in config.md works - existing keys are preserved when extending with new sections.
  </action>
  <verify>
1. `cat .planning/config.json` shows all original keys plus profiles
2. `jq '.mode' .planning/config.json` returns "yolo" (preserved)
3. `jq '.profiles.active_profile' .planning/config.json` returns "balanced"
  </verify>
  <done>
- `.planning/config.json` contains both original keys (mode, depth, parallelization) and new profiles schema
- File is valid JSON with 2-space indentation
- active_profile defaults to "balanced" per documented behavior
  </done>
</task>

<task type="auto">
  <name>Task 2: Document gap closure limitations</name>
  <files>.planning/phases/01-config-foundation/01-config-foundation-VERIFICATION.md</files>
  <action>
Update the VERIFICATION.md file to reflect:

1. Gaps 1 and 4 are now closed by the seeded config.json
2. Gaps 2 (validation error messages) and 3 (corruption recovery) remain open but are DEFERRED to Phase 3

Add a section at the end:

```markdown
## Gap Closure Status (01-02)

| Gap | Status | Notes |
|-----|--------|-------|
| Persistence of profiles | CLOSED | config.json now includes profiles schema |
| Key preservation when extending | CLOSED | Existing mode/depth/parallelization preserved |
| Invalid profile error messages | DEFERRED | Requires /gsd-set-profile command (Phase 3) |
| Corruption recovery | DEFERRED | Behavior documented; runtime exercise in Phase 3 |

**Deferred gaps rationale:**
- Validation error messages require a command that accepts user input to demonstrate the error path
- Corruption recovery requires a runtime reader that encounters corrupted JSON
- Both will be exercised when /gsd-set-profile is implemented in Phase 3
```
  </action>
  <verify>
`grep -A 10 "Gap Closure Status" .planning/phases/01-config-foundation/01-config-foundation-VERIFICATION.md` shows the table
  </verify>
  <done>
VERIFICATION.md updated to reflect which gaps are closed vs deferred
  </done>
</task>

</tasks>

<verification>
Phase 1 gap closure verified when:

1. `.planning/config.json` contains:
   - Original keys: mode, depth, parallelization (unchanged)
   - New keys: profiles.active_profile, profiles.custom_overrides

2. Schema matches config.md documentation:
   - active_profile is "balanced" (default)
   - custom_overrides is empty object

3. VERIFICATION.md documents closed vs deferred gaps

4. File is valid JSON:
   ```bash
   jq . .planning/config.json >/dev/null && echo "Valid JSON"
   ```
</verification>

<success_criteria>
- Config.json extended with profiles schema while preserving all existing keys
- Demonstrates Phase 1 goal: "Config system exists with JSON persistence"
- Two gaps closed (persistence, key preservation)
- Two gaps documented as deferred to Phase 3 (validation messages, corruption recovery)
</success_criteria>

<output>
After completion, create `.planning/phases/01-config-foundation/01-02-SUMMARY.md`
</output>
